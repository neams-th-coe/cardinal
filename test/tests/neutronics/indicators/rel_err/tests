[Tests]
  issues = '#1146 #1106'
  design = 'StatRelErrorIndicator.md'

  [rel_err]
    type = Exodiff
    input = 'openmc.i'
    exodiff = 'openmc_out.e'
    requirement = 'The system shall allow for the use of the statistical relative error of a tally score as an indicator.'
    mesh_mode = 'replicated'
    capabilities = 'openmc'
  []
  [no_score]
    type = RunException
    input = 'openmc.i'
    cli_args = 'Adaptivity/Indicators/stat_err/score=flux'
    requirement = 'The system shall error if the provided score does not exist in StatRelErrorIndicator.'
    expect_err = 'The problem does not contain any score named flux!'
    mesh_mode = 'replicated'
    capabilities = 'openmc'
  []
  [no_rel_err]
    type = RunException
    input = 'openmc.i'
    cli_args = 'Problem/Tallies/Mesh/output=""'
    requirement = 'The system shall error if no tallies are storing the relative error of the provided score.'
    expect_err = 'The problem does not contain any tallies that output the relative error for the score kappa_fission!'
    mesh_mode = 'replicated'
    capabilities = 'openmc'
  []
  [invalid_bin]
    type = RunException
    input = 'openmc.i'
    cli_args = 'Adaptivity/Indicators/stat_err/ext_filter_bin=1'
    requirement = 'The system shall error if the provided tally external filter bin is greater than the total number of external filter bins.'
    expect_err = 'The external filter bin provided is invalid for the number of external filter bins'
    mesh_mode = 'replicated'
    capabilities = 'openmc'
  []
  [duplicate_scores]
    type = CSVDiff
    input = openmc_dup.i
    csvdiff = openmc_dup_out.csv
    cli_args = "Adaptivity/Indicators/stat_err/tally='Mesh'"
    requirement = "The system shall allow for the computation of relative error indicators "
                  "when multiple tallies are added which accumulate the same scores."
    capabilities = 'openmc'
  []
  [duplicate_scores_tally_not_provided]
    type = RunException
    input = openmc_dup.i
    requirement = "The system shall error if two tallies accumulate the same scores and the user doesn't "
                  "select one to use for relative errors."
    expect_err = "When adding more then one tally with kappa-fission in the \[Tallies\] block, the 'tally' parameter is required!"
    capabilities = 'openmc'
  []
  [duplicate_scores_missing_tally]
    type = RunException
    input = openmc_dup.i
    cli_args = "Adaptivity/Indicators/stat_err/tally='na'"
    requirement = "The system shall error if the user provides a non-existent tally."
    expect_err = "This tally does not exist"
    capabilities = 'openmc'
  []
  [duplicate_scores_tally_has_no_score]
    type = RunException
    input = openmc_dup.i
    cli_args = "Adaptivity/Indicators/stat_err/tally='Cell_2'"
    requirement = "The system shall error if the user provides a tally that does not accumulate the score."
    expect_err = "This tally does not score kappa-fission!"
    capabilities = 'openmc'
  []
[]
