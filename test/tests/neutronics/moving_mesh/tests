[Tests]
  design = 'OpenMCVolumeCalculation.md OpenMCCellAverageProblem.md MoabSkinner.md'
  issues = '#899'

  [inconsistency]
    type = RunException
    input = aux_no_move_b1.i
    cli_args = '--error'
    expect_err = "Your problem has a moving mesh, but you have not provided a 'skinner'"
    requirement = 'The system shall warn the user if there is an inconsistency between a moving mesh and the underlying OpenMC geometry.'
    required_object = 'OpenMCCellAverageProblem'
  []
  [cell_tally]
    type = Exodiff
    input = cell_tally.i
    exodiff = cell_tally_out.e
    requirement = 'The system shall correctly reinitialize cell tallies when the mesh is moving. This is tested by translating the mesh over a stationary OpenMC model. The two cell tallies in the tallies.out file match the expected power density (accounting for the actual fractions of the cell which map to the moving mesh). This test also checks the cell IDs and instances as the mesh translates."
    required_object = 'OpenMCCellAverageProblem'
  []
  [mesh_tally]
    type = Exodiff
    input = mesh_tally.i
    exodiff = mesh_tally_out.e
    requirement = 'The system shall correctly use a mesh tally on a moving MOOSE mesh. This is tested by translating the mesh over a stationary OpenMC model. The mesh translation exposes 20 percent of the left subdomain, which from a non-moving case we record 8 percent of the total power deposition in this region. For the moving mesh case, the total power deposited in the mesh tally is 92 percent.'
    required_object = 'OpenMCCellAverageProblem'
  []
  [make_mesh]
    type = RunApp
    input = mesh_tally.i
    cli_args = '--mesh-only]
    requirement = 'The system shall generate a file for mesh tallies.'
  []
  [file_mesh]
    type = RunException
    input = mesh_tally_file.i
    prereq = make_mesh
    expect_err = "Tallying on a file-based mesh is not supported for moving-mesh cases"
    requirement = 'The system shall error if tallying on a file mesh for moving mesh cases, because there will be a disagreement between the mesh elements and the [Mesh]."
    required_object = 'OpenMCCellAverageProblem'
  []
  [temperature]
    type = Exodiff
    input = temperature.i
    exodiff = temperature_out.e
    requirement = 'The system shall correctly reinitialize temperature mapping and output of cell temperatures to a moving mesh. This is tested by applying temperatures based on the moving mesh.'
    required_object = 'OpenMCCellAverageProblem'
  []
  [density]
    type = Exodiff
    input = density.i
    exodiff = density_out.e
    requirement = 'The system shall correctly reinitialize density mapping and output of cell densities and material fills to a moving mesh. This is tested by applying densities based on the moving mesh.'
    required_object = 'OpenMCCellAverageProblem'
  []
[]
