#ifdef __okl__

#include "brick.oudf"

#endif

void userSource(double time)
{
  // note: when running with Cardinal, Cardinal will allocate the usrwrk
  // array. If running with NekRS standalone (e.g. nrsmpi), you need to
  // replace the usrwrk with some other value or allocate it youself from
  // the udf and populate it with values.
  auto mesh = nrs->meshV;
  mooseHeatSource(mesh->Nelements, nrs->scalar->fieldOffset(), platform->app->bc->o_usrwrk, nrs->scalar->o_EXT);
}

void UDF_Setup()
{
  nrs->userSource = &userSource;

  auto mesh = nrs->meshV;

  std::vector<dfloat> temp(mesh->Nlocal, 0.0);

  for (int n = 0; n < mesh->Nlocal; n++)
  {
    temp[n] = 700.0;
  }
  nrs->scalar->o_solution("temperature").copyFrom(temp.data(), temp.size());
}

void UDF_ExecuteStep(double time, int tstep)
{

}
