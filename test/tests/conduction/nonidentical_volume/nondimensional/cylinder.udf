#ifdef __okl__

#include "cylinder.oudf"

#endif

static occa::kernel mooseHeatSourceKernel;
void UDF_LoadKernels(occa::properties & kernelInfo)
{
  mooseHeatSourceKernel = oudfBuildKernel(kernelInfo, "mooseHeatSource");
}

void userq(double time)
{
  auto mesh = nrs->meshV;
  mooseHeatSource(mesh->Nelements, 0, platform->app->bc->o_usrwrk, nrs->scalar->o_EXT);
}

void UDF_Setup()
{
  nrs->userSource = &userq;
  auto mesh = nrs->meshV;
  std::vector<dfloat> U(mesh->dim * nrs->fluid->fieldOffset, 0.0);
  std::vector<dfloat> P(mesh->Nlocal, 0.0);
  std::vector<dfloat> temp(mesh->Nlocal, 0.0);
  for(int n = 0; n < mesh->Nlocal; n++) {
    U[n + 0 * nrs->fluid->fieldOffset] = 0.0; // x-velocity
    U[n + 1 * nrs->fluid->fieldOffset] = 0.0; // y-velocity
    U[n + 2 * nrs->fluid->fieldOffset] = 0.0; // z-velocity
    P[n] = 0.0; // pressure
    temp[n] = 0.0;
  }
  nrs->fluid->o_U.copyFrom(U.data(), U.size());
  nrs->fluid->o_P.copyFrom(P.data(), P.size());
  nrs->scalar->o_solution("temperature").copyFrom(temp.data(), temp.size());
}

void UDF_ExecuteStep(double time, int tstep)
{
}
