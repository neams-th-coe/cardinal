#include "udf.hpp"

void UDF_LoadKernels(occa::properties & kernelInfo)
{
}

void UDF_Setup(nrs_t *nrs)
{
  auto mesh = nrs->cds->mesh[0];

  int n_gll_points = mesh->Np * mesh->Nelements;
  for (int n = 0; n < n_gll_points; ++n)
  {
    dfloat x = mesh->x[n];
    dfloat y = mesh->y[n];
    dfloat z = mesh->z[n];

    // x-velocity is chosen to be the temperature minus the function we intend
    // to compare against for the L2 norm
    nrs->U[n + 0 * nrs->fieldOffset] = std::pow((exp(x) + sin(y) + x*y*z - (exp(x*x)+0.7*y+0.8*z+1)), 2);

    // y-velocity is chosen to be the temperature minus the function we intend
    // to compare against for the L1 norm
    nrs->U[n + 1 * nrs->fieldOffset] = (exp(x) + sin(y) + x*y*z - (exp(x*x)+0.7*y+0.8*z+1));

    // temperature
    nrs->cds->S[n + 0 * nrs->cds->fieldOffset[0]] = exp(x) + sin(y) + x*y*z;
  }
}

void UDF_ExecuteStep(nrs_t *nrs, double time, int tstep)
{
}
